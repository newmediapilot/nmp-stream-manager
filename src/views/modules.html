<!-- src/views/dashboard.html -->
{% extends "layouts/main.njk" %}
{% from "macros/public_module_styles.njk" import public_module_styles %}
{% from "macros/qrcode_dialog.njk" import qrcode_dialog %}
{% set cache_buster = "" | currentTime %}
{% set public_routes = 'public_routes' | getParam %}
{% block hscripts %}
<link rel="stylesheet" href="/style/modules.css?cb={{cache_buster}}">
{% endblock %}
{% block body %}
{% include "partials/controls.njk" %}
<style>
    .module {
        overflow: hidden;
        transition: height 333ms linear;
    }
    .module .title p {
        flex-grow: 1;
        font-size: 30px;
        margin-left: 10px;
        background: repeating-linear-gradient(45deg, rgba(0, 0, 0, .05) 0px, rgba(0, 0, 0, .05) 2px, rgba(255, 255, 255, .05) 2px, rgba(255, 255, 255, .05) 4px);
    }
    .module .title button {
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 10px;
        font-size: 30px;
        margin: 3px;
        width: 40px;
        background: repeating-linear-gradient(-45deg, rgba(0, 0, 0, .05) 0px, rgba(0, 0, 0, .05) 2px, rgba(255, 255, 255, .05) 2px, rgba(255, 255, 255, .05) 4px);
    }
    .module .title input[type="checkbox"] {
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 10px;
        font-size: 30px;
        margin: 3px;
        width: 40px;
        background: repeating-linear-gradient(-45deg, rgba(0, 0, 0, .05) 0px, rgba(0, 0, 0, .05) 2px, rgba(255, 255, 255, .05) 2px, rgba(255, 255, 255, .05) 4px);
    }
    .module .title input[type="checkbox"]:after {
        content:"‚úè";
    }
    .module .title input[type="checkbox"]:checked:after{
        content: "‚òë";
    }
</style>
{% set public_routes = 'public_routes' | getParam %}
{{ public_module_styles() }}
<div class="modules">
    {% for a in [1, 2, 3] %}
    <div class="module aqua">
        <div class="title">
            <p>BPM</p>
            <button onclick="javascript:showPanelQR('#heart_embed_qrcode_dialog', 'BPM')">üîó</button>
            <input onclick="javascript:togglePanelPreview(this, 'BPM')" type="checkbox">
        </div>
        <div class="preview">
            <iframe width="1920" height="1080" src="{{public_routes.PUBLIC_HEART_EMBED}}"></iframe>
        </div>
        <div class="controls">
            <div class="module-9x9-selector">
                <ul>
                    {% for r1 in [1, 2, 3] %}{% for c1 in [1, 2, 3] %}
                    <li>
                        <input onclick="javascript:pushStyleUpdates()" type="radio" name="group1"
                               value="--heart-grid-column-start:{{ c1 }}; --heart-grid-column-end:{{ c1 + 1 }};--heart-grid-row-start:{{ r1 }}; --heart-grid-row-end:{{ r1 + 1 }};">
                    </li>
                    {% endfor %}{% endfor %}
                </ul>
            </div>
            <div class="module-9x9-selector">
                <ul>
                    {% for r1 in ['flex-start', 'center', 'end'] %}{% for c1 in ['flex-start', 'center', 'end'] %}
                    <li>
                        <input onclick="javascript:pushStyleUpdates()" type="radio" name="group2"
                               value="--heart-align-self:{{ r1 }}; --heart-justify-self:{{ c1 }};">
                    </li>
                    {% endfor %}{% endfor %}
                </ul>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
{% block fscripts %}
{{ qrcode_dialog("heart_embed_qrcode_dialog", public_routes.PUBLIC_HEART_EMBED ) }}
generateQrCode(document.querySelector("#qr-code-dialog-canvas").getAttribute('data-url'), "#qr-code-dialog-canvas")
<script>
    document.addEventListener("DOMContentLoaded", () => setupCssVariable('.preview', 'width', '--js-module-preview-width'));
    document.addEventListener("DOMContentLoaded", () => setupCssVariable('.title', 'height', '--js-module-title-height'));
    document.addEventListener("DOMContentLoaded", () => setupCssVariable('.module', 'height', '--js-module-module-height'));
    document.addEventListener("DOMContentLoaded", () => initPanelPreview());
    document.addEventListener("DOMContentLoaded", () => applyStyleUpdates());
    // document.addEventListener("DOMContentLoaded", () => socketWatchReload());
</script>
{% endblock %}