<!-- src/views/dashboard.html -->
{% extends "layouts/main.njk" %}
{% from "macros/public_module_styles.njk" import public_module_styles %}
{% from "macros/qrcode_dialog.njk" import qrcode_dialog %}
{% set cache_buster = "" | currentTime %}
{% set public_routes = 'public_routes' | getParam %}
{% block hscripts %}
<link rel="stylesheet" href="/style/modules.css?cb={{cache_buster}}">
{% endblock %}
{% block body %}
{% include "partials/controls.njk" %}
<style>

    input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 30px;
        background: #ddd;
        border-radius: 30px;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 30px;
        height: 30px;
        background: #ff0062;
        border-radius: 30px;
    }

    :root {
        --module-heart-scaleX: 1;
        --module-heart-scaleY: 1;
        --module-heart-scaleZ: 1;
        --module-heart-translateX: 0;
        --module-heart-translateY: 0;
        --module-heart-translateZ: 0;
        --module-heart-rotateX: 0;
        --module-heart-rotateY: 0;
        --module-heart-rotateZ: 0;
    }

    .preview:after {
        --preview-padding: 10px;
        content: "";
        width: calc(100% - calc(2 * var(--preview-padding)));
        height: calc(100% - calc(2 * var(--preview-padding)));
        box-sizing: border-box;
        border: 1px dashed white;
        display: block;
        position: absolute;
        left: var(--preview-padding);
        top: var(--preview-padding);
        transform: scaleX(var(--module-heart-scaleX)) scaleY(var(--module-heart-scaleY)) scaleZ(var(--module-heart-scaleZ)) translateX(var(--module-heart-translateX)) translateY(var(--module-heart-translateY)) translateZ(var(--module-heart-translateZ)) rotateX(var(--module-heart-rotateX)) rotateY(var(--module-heart-rotateY)) rotateZ(var(--module-heart-rotateZ));
    }

</style>
{% set public_routes = 'public_routes' | getParam %}
{{ public_module_styles() }}
<!--&#45;&#45;module-heart-scaleX: 1;-->
<!--&#45;&#45;module-heart-scaleY: 1;-->
<!--&#45;&#45;module-heart-scaleZ: 1;-->
<!--&#45;&#45;module-heart-translateX: 0;-->
<!--&#45;&#45;module-heart-translateY: 0;-->
<!--&#45;&#45;module-heart-translateZ: 0;-->
<!--&#45;&#45;module-heart-rotateX: 0;-->
<!--&#45;&#45;module-heart-rotateY: 0;-->
<!--&#45;&#45;module-heart-rotateZ: 0;-->
<div class="modules">
    <div class="module bloodorange">
        <div class="title">
            <p>BPM</p>
            <button onclick="javascript:showPanelQR('#heart_embed_qrcode_dialog', 'BPM')">ðŸ”—</button>
        </div>
        <div class="preview">
            <iframe width="1920" height="1080" src="{{public_routes.PUBLIC_HEART_EMBED}}"></iframe>
        </div>
        <div class="controls">
            <input type="range" id="--module-heart-scaleX:" value="100" name="%;" onchange="pushStyleUpdates()" min="0"
                   max="100" step="10">
            <!--            <input type="range" id="&#45;&#45;module-heart-scaleZ" name="%" min="0" max="100" value="100" step="10">-->
            <!--            <input type="range" id="&#45;&#45;module-heart-translateX" name="%" min="0" max="360" value="0" step="36">-->
            <!--            <input type="range" id="&#45;&#45;module-heart-translateY" name="%" min="0" max="360" value="0" step="36">-->
            <!--            <input type="range" id="&#45;&#45;module-heart-translateZ" name="%" min="0" max="360" value="0" step="36">-->
            <!--            <input type="range" id="&#45;&#45;module-heart-rotateX" name="%" min="0" max="360" value="0" step="36">-->
            <!--            <input type="range" id="&#45;&#45;module-heart-rotateY" name="%" min="0" max="360" value="0" step="36">-->
            <!--            <input type="range" id="&#45;&#45;module-heart-rotateZ" name="%" min="0" max="360" value="0" step="36">-->
        </div>
    </div>
</div>
{% endblock %}
{% block fscripts %}
<!-- dialogs start -->
{{ qrcode_dialog("heart_embed_qrcode_dialog", public_routes.PUBLIC_HEART_EMBED ) }}
{{ qrcode_dialog("feature_embed_qrcode_dialog", public_routes.PUBLIC_FEATURE_EMBED ) }}
<!-- dialogs end -->
<script>
    document.addEventListener("DOMContentLoaded", () => socketWatchReload());
    document.addEventListener("DOMContentLoaded", () => iframeDetect());
    document.addEventListener("DOMContentLoaded", () => scrollSnap('.modules'));
    document.addEventListener("DOMContentLoaded", () => setCssVariable('.preview', 'width', '--js-module-preview-width'));
    document.addEventListener("DOMContentLoaded", () => setCssVariable('.title', 'height', '--js-module-title-height', 'px'));
    document.addEventListener("DOMContentLoaded", () => setCssVariable('.module', 'height', '--js-module-content-height', 'px'));
    document.addEventListener("DOMContentLoaded", () => applyStyleUpdates());
</script>
{% endblock %}