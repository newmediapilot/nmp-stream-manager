<!-- src/views/dashboard.html -->
{% extends "layouts/main.njk" %}
{% from "macros/public_module_styles.njk" import public_module_styles %}
{% from "macros/qrcode_dialog.njk" import qrcode_dialog %}
{% set cache_buster = "" | currentTime %}
{% set public_routes = 'public_routes' | getParam %}
{% block hscripts %}
<link rel="stylesheet" href="/style/modules.css?cb={{cache_buster}}">
{% endblock %}
{% block body %}
{% include "partials/controls.njk" %}
<style>

    .module input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 100%;
        background: repeating-linear-gradient(-45deg, #fff, #ccc 10px);
        overflow: hidden;
    }

    .module input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 50px;
        height: 50px;
        background: repeating-radial-gradient(circle, #4f4f4f 0px, #020202 10px);
    }

    .module .controls {
        max-width: 100%;
        display: grid;
        grid-template-columns: repeat(4, 100px);
        gap: 10px;
        margin: 10px;
        height: 100px;
        padding-right: 10px
    }

    .module label {
        background: repeating-linear-gradient(-45deg, #fff, #ccc 10px);
        position: relative;
        max-height: 100px;
        overflow: scroll;
        transform: scale(-1);
    }

    .module label input[type="range"] {
        background: repeating-linear-gradient(-45deg, #fff, #ccc 10px);
        pointer-events: none;
        width: 50px;
        height: 50px;
        margin: 50px;
    }

</style>
{% set public_routes = 'public_routes' | getParam %}
<div class="modules">
    <div class="module aqua">
        <div class="title">
            <p>FEATURE</p>
            <button onclick="javascript:showPanelQR('#feature_embed_qrcode_dialog', 'FEATURE')">ðŸ”—</button>
        </div>
        <div class="preview">
            <iframe width="1920" height="1080"
                    src="{{public_routes.PUBLIC_FEATURE_EMBED}}?featuredName=aaknot#featuredNameLock"></iframe>
        </div>
        <div class="controls">
            <label>
                <input oninput="javascript:renderStyleUpdates()" onchange="javascript:pushStyleUpdates()"
                       type="range" value="0.25" min="0.5" max="1" step="0.05" name="" id="--module-feature-scaleX">
                <input oninput="javascript:renderStyleUpdates()" hidden onchange="javascript:pushStyleUpdates()"
                       type="range" value="0.25" min="0.5" max="1" step="0.05" name="" id="--module-feature-scaleY">
            </label>
            <label>
                <input oninput="javascript:renderStyleUpdates()" onchange="javascript:pushStyleUpdates()"
                       type="range" value="50" min="50" max="100" step="5" name="" id="--module-feature-translateX">
                <input oninput="javascript:renderStyleUpdates()" hidden onchange="javascript:pushStyleUpdates()"
                       type="range" value="50" min="50" max="100" step="5" name="" id="--module-feature-translateY">
            </label>
            <label>
                <input oninput="javascript:renderStyleUpdates()" onchange="javascript:pushStyleUpdates()"
                       type="range" value="50" min="50" max="100" step="5" name="" id="--module-feature-rotateX">
                <input oninput="javascript:renderStyleUpdates()" hidden onchange="javascript:pushStyleUpdates()"
                       type="range" value="50" min="50" max="100" step="5" name="" id="--module-feature-rotateY">
            </label>
        </div>
    </div>
<!--    <div class="module bloodorange">-->
<!--        <div class="title">-->
<!--            <p>BPM</p>-->
<!--            <button onclick="javascript:showPanelQR('#heart_embed_qrcode_dialog', 'BPM')">ðŸ”—</button>-->
<!--        </div>-->
<!--        <div class="preview">-->
<!--            <iframe width="1920" height="1080" src="{{public_routes.PUBLIC_HEART_EMBED}}"></iframe>-->
<!--        </div>-->
<!--        <div class="controls">-->
<!--            <input oninput="javascript:renderStyleUpdates()" onchange="javascript:pushStyleUpdates()"-->
<!--                   type="range" value="0.25" min="0.5" max="1" step="0.05" name="" id="&#45;&#45;module-heart-scaleX">-->
<!--            <input oninput="javascript:renderStyleUpdates()" onchange="javascript:pushStyleUpdates()"-->
<!--                   type="range" value="0.25" min="0.5" max="1" step="0.05" name="" id="&#45;&#45;module-heart-scaleX">-->
<!--            <label>-->
<!--                <input oninput="javascript:renderStyleUpdates()" type="range" value="0.25" min="0.5" max="1"-->
<!--                       step="0.05" name="" id="&#45;&#45;module-heart-translateX">-->
<!--            </label>-->
<!--        </div>-->
<!--    </div>-->
</div>
{% endblock %}
{% block fscripts %}
<!-- dialogs start -->
{{ qrcode_dialog("heart_embed_qrcode_dialog", public_routes.PUBLIC_HEART_EMBED ) }}
{{ qrcode_dialog("feature_embed_qrcode_dialog", public_routes.PUBLIC_FEATURE_EMBED ) }}
<!-- dialogs end -->
<script>
    document.addEventListener("DOMContentLoaded", () => setCssVariable('.preview', 'width', '--js-module-preview-width'));
    document.addEventListener("DOMContentLoaded", () => setCssVariable('.title', 'height', '--js-module-title-height', 'px'));
    document.addEventListener("DOMContentLoaded", () => setCssVariable('.module', 'height', '--js-module-content-height', 'px'));
    document.addEventListener("DOMContentLoaded", () => detectMouseCoordinates());
    document.addEventListener("DOMContentLoaded", () => applyStyleUpdates());
    document.addEventListener("DOMContentLoaded", () => socketWatchReload());
    document.addEventListener("DOMContentLoaded", () => iframeDetect());
    document.addEventListener("DOMContentLoaded", () => renderMatrixStyle());
    document.addEventListener("DOMContentLoaded", () => scrollSnap('.modules'));
    document.addEventListener("DOMContentLoaded", () => {
        // @eyecandy
        // anime({
        //     targets: '.module .preview',
        //     duration: 9000,
        //     easing: 'linear',
        //     loop: true,
        //     update: function (anim) {
        //         const percentage = anim.progress;
        //         const hueRotation = (percentage * 360) / 100;
        //         document.querySelector('.module .preview').style.filter = `hue-rotate(${hueRotation}deg)`;
        //     }
        // });
    });
</script>
{% endblock %}