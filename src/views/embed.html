<!-- src/views/embed.html -->
{% extends "layouts/main.njk" %}
{% block hscripts %}
<link rel="stylesheet" href="/style/embed.css">
{% endblock %}
{% block body %}
<iframe id="twitch-embed"
        frameborder="0"
        allowfullscreen="true"
        scrolling="no"
        height="100%"
        width="100%">
</iframe>
<div>
    <canvas id="streamer-qr-code"></canvas>
</div>
{% endblock %}
{% block fscripts %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        let embedActive = false;
        let streamers = [
            "stonerkat_",
            "toenailcentral",
            "machoot",
            "kittykosmos",
            "djcristianadematos",
            "avacrown_",
            "vera_vex",
            "lionastone",
        ];
        const twitchEmbed = document.querySelector('#twitch-embed');
        const qrCode = document.getElementById('streamer-qr-code');
        const toggleEmbed = (bool, streamerName) => {
            const streamer = streamerName || streamers[Math.floor(Math.random() * streamers.length)];
            const URL = `https://player.twitch.tv/?channel=${streamer}&parent=localhost&muted=false`;
            twitchEmbed.src = bool ? URL : "";
            streamers.push(streamers.shift());
            if (bool) {
                generateQrCode(URL, 'streamer-qr-code');
                qrCode.style.display = 'initial';
            } else {
                qrCode.style.display = 'none';
            }
            embedActive = bool;
        };
        socketConnect((payload) => ('feature:toggle' === payload) && toggleEmbed(!embedActive));
        toggleEmbed(true, 'aaknot');
    });
</script>
{% endblock %}