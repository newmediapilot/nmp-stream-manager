{% extends "layouts/main.njk" %}
{% set cache_buster = "" | currentTime %}
{% set public_routes = "public_routes" | getParam %}
{% block hscripts %}
<link rel="stylesheet" href="/style/dashboard.css?cb={{cache_buster}}">
{% endblock %}
{% block body %}
<div class="dashboard">
    {% for config in "dashboard_signals_config" | getParam %}
    {% if config.type == "feature" %}
    {% set data_href = public_routes.PUBLIC_SIGNAL_CREATE ~ "?api=feature&type=" ~ config.type ~ "&description=" ~
    config.description ~ ":" ~ config.label %}
    {% elif config.type == "mark" %}
    {% set data_href = public_routes.PUBLIC_SIGNAL_CREATE ~ "?api=no-feature&type=" ~ config.type ~ "&description=" ~
    config.label %}
    {% else %}
    {% set data_href = public_routes.PUBLIC_SIGNAL_CREATE ~ "?api=no-feature&type=" ~ config.type ~ "&description=" ~
    config.description %}
    {% endif %}
    <div class="button button-{{ config.theme }}" href="{{data_href}}">
        <button
                data-href="{{ data_href }}"
                onclick="javascript:sendSignal(this)">
            <label>{{ config.emoji }}</label>
            <label>{{ config.label }}</label>
        </button>
    </div>
    {% endfor %}
</div>
{% include "partials/controls.njk" %}
{% endblock %}
{% block extras %}
<!-- dialogs start -->
<dialog id="qr-dialog"
        data-url="https://{{ device_ip  }}{{ public_route }}">
    <h2 class="dialog--title">QR Code Dialog</h2>
    <h3 class="dialog--body">This link will open this page on any device on your network</h3>
    <canvas/>
    <button>Click to Copy Link!</button>
    <button style="background: green" onclick="javascript:hideDialog('qr-dialog')">âœ…Done</button>
</dialog>
<!-- dialogs end -->
{% endblock %}
{% block fscripts %}
<script defer>
    document.addEventListener("DOMContentLoaded", () => iframeDetect());
    document.addEventListener("DOMContentLoaded", () => socketConnect());
    document.addEventListener("DOMContentLoaded", () => socketWatchReload());
    document.addEventListener("DOMContentLoaded", () => scrollSnap(document.querySelector(".dashboard")));
    document.addEventListener("DOMContentLoaded", () => generateCopyLink(document.querySelector(".dashboard")));
    document.addEventListener("DOMContentLoaded", () => generateQrCode(
        document.querySelector("#qr-dialog").getAttribute("data-url"),
        document.querySelector("#qr-dialog canvas")
    ));
    document.addEventListener("DOMContentLoaded", () => dashboard());
    document.addEventListener("DOMContentLoaded", () => {
        anime({
            targets: "html.iframe .dashboard button",
            duration: 1500,
            delay: anime.stagger(210),
            easing: "easeInOutCubic",
            direction: "alternate",
            borderTopWidth: ["20px", "200px"],
            borderBottomWidth: ["20px", "200px"],
            borderLeftWidth: ["20px", "200px"],
            borderRightWidth: ["20px", "200px"],
            borderRadius: ["15px", "30px"]
        });
    });
    document.addEventListener("DOMContentLoaded", () => {
        anime({
            targets: ".dashboard button",
            duration: 3000,
            delay: anime.stagger(50),
            easing: "easeInElastic(1, .6)",
            filter: "hue-rotate(360deg)",
            loopBegin: function (anim) {
                setTimeout(anim.play, 7000);
            }
        });
    });
    document.addEventListener("DOMContentLoaded", () => socketConnect());
    document.addEventListener("DOMContentLoaded", () => socketWatchReload());
</script>
{% endblock %}