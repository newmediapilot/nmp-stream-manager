{%extends "layouts/main.njk"%}
{%set cache_buster = "" | currentTime%}
{%set public_routes = 'public_routes' | getParam%}
{%block hscripts%}
<link rel="stylesheet" href="/style/modules.css?cb={{cache_buster}}">
{%from "macros/public_module_styles.njk" import public_module_styles %}
{{public_module_styles()}}
{%endblock%}
{%block body%}
{%set public_routes = 'public_routes' | getParam%}
<section class="modules">
    <div class="module aqua">
        <div class="title" aria-label="FEATURE">
            <button onclick="javascript:document.body.querySelector('#qr-dialog').showModal()" aria-label="ðŸ”—"></button>
        </div>
        <div class="preview">
            <iframe width="1920"
                    height="1080"
                    src="{{public_routes.PUBLIC_FEATURE_EMBED}}?featuredName=0#featuredNameLock">
            </iframe>
        </div>
        <div class="controls">
            <label aria-label="size">
                <input type="range" min="33" max="99" step="33" value="33" name="--_feat-scaleX">
                <input type="range" min="33" max="99" step="33" value="33" name="--_feat-scaleY" hidden>
            </label>
            <label aria-label="move">
                <input type="range" min="0" max="66" step="33" value="66" name="--_feat-translateX">
                <input type="range" min="0" max="66" step="33" value="66" name="--_feat-translateY" hidden>
            </label>
<!--            <label aria-label="spin">-->
<!--                <input type="range" min="33" max="99" step="33" value="33" name="&#45;&#45;_feat-rotateX">-->
<!--                <input type="range" min="33" max="99" step="33" value="33" name="&#45;&#45;_feat-rotateY" hidden>-->
<!--            </label>-->
        </div>
    </div>
    <!--    <div class="module bloodorange">-->
    <!--        <div class="title" aria-label="BPM">-->
    <!--            <button onclick="javascript:document.body.querySelector('#qr-dialog').showModal()" aria-label="ðŸ”—"></button>-->
    <!--        </div>-->
    <!--        <div class="preview">-->
    <!--            <iframe width="1920" height="1080" src="{{public_routes.PUBLIC_BPM_EMBED}}"></iframe>-->
    <!--        </div>-->
    <!--        <div class="controls">-->
    <!--            <label aria-label="size">-->
    <!--                <input type="range" min="80" max="100" step="1" value="100" name="&#45;&#45;_bpm-scaleX">-->
    <!--                <input type="range" min="80" max="100" step="1" value="100" name="&#45;&#45;_bpm-scaleY" hidden>-->
    <!--            </label>-->
    <!--            <label aria-label="move">-->
    <!--                <input type="range" min="0" max="10" step="1" value="0" name="&#45;&#45;_bpm-translateX">-->
    <!--                <input type="range" min="0" max="10" step="1" value="0" name="&#45;&#45;_bpm-translateY" hidden>-->
    <!--            </label>-->
    <!--            <label aria-label="spin">-->
    <!--                <input type="range" min="33" max="99" step="33" value="33" name="&#45;&#45;_bpm-rotateX">-->
    <!--                <input type="range" min="33" max="99" step="33" value="33" name="&#45;&#45;_bpm-rotateY" hidden>-->
    <!--            </label>-->
    <!--        </div>-->
    <!--    </div>-->
</section>
{%include "partials/controls.njk"%}
{%endblock%}
{%block dialogs%}
{%set device_ip = "device_ip" | getParam%}
<dialog id="qr-dialog" data-url="https://{{device_ip }}{{public_routes.PUBLIC_DASHBOARD}}">
    <h2 aria-label="QR Code Dialogk"></h2>
    <h3 aria-label="This link will open this page on any device on your network"></h3>
    <canvas></canvas>
    <button aria-label="Click to Copy Link!"></button>
    <button aria-label="âœ…Done" onclick="javascript:document.body.querySelector('#qr-dialog').close();"></button>
</dialog>
{%endblock%}
{%block fscripts%}
<script defer>
    document.addEventListener("DOMContentLoaded", () => iframeDetect());
    document.addEventListener("DOMContentLoaded", () => socketConnect());
    document.addEventListener("DOMContentLoaded", () => socketWatchReload());
    document.addEventListener("DOMContentLoaded", () => scrollSnap(document.body.querySelector("body > section")));
    document.addEventListener("DOMContentLoaded", () => generateCopyLink(document.body.querySelector("#qr-dialog")));
    document.addEventListener("DOMContentLoaded", () => generateQrCode(
        document.body.querySelector("#qr-dialog canvas"),
        document.body.querySelector("#qr-dialog").getAttribute("data-url"),
    ));
    document.addEventListener("DOMContentLoaded", () => setCssVariable('.preview', 'width', '--js-module-preview-width'));
    document.addEventListener("DOMContentLoaded", () => setCssVariable('.title', 'height', '--js-module-title-height', 'px'));
    document.addEventListener("DOMContentLoaded", () => setCssVariable('.module', 'height', '--js-module-content-height', 'px'));
    document.addEventListener("DOMContentLoaded", () => applyModuleStyles());
    document.addEventListener("DOMContentLoaded", () => initializeModuleClickTouch());
</script>
{%endblock%}