{%extends "main.njk"%}
{%set public_routes = 'public_routes'|getParam%}
{%block cdn%}{%endblock%}
{%block client%}{%endblock%}}
{%block head%}
<script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js?{{cacheBuster}}" type="text/javascript" defer></script>
<script crossorigin="anonymous" src="https://cdn.socket.io/4.0.0/socket.io.min.js?{{cacheBuster}}" type="text/javascript" defer></script>
<script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js?{{cacheBuster}}" type="text/javascript" defer></script>
<link href="../client/style/index.css?{{cacheBuster}}" rel="stylesheet">
<script src="../client/script/service_worker.js?{{cacheBuster}}" defer type="text/javascript"></script>
<script src="../client/script/reduced_motion.js?{{cacheBuster}}" defer type="text/javascript"></script>
{%endblock%}
{%block body%}
<main>
    <iframe src="{{public_routes.PANEL_LAYOUT}}"></iframe>
    <iframe src="{{public_routes.PANEL_DASHBOARD}}"></iframe>
    <iframe src="{{public_routes.PANEL_ACTIONS}}"></iframe>
    <iframe src="{{public_routes.PANEL_DRAW}}"></iframe>
</main>
{%endblock%}
{%block scripts%}
<script defer src="../client/script/socket.js?{{cacheBuster}}" type="text/javascript"></script>
<script defer src="../client/script/detect_press_hold.js?{{cacheBuster}}" type="text/javascript"></script>
<script defer src="../client/script/debounce_function.js?{{cacheBuster}}" type="text/javascript"></script>
<script defer>
    document.addEventListener("DOMContentLoaded", () => reducedMotion());
    document.addEventListener("DOMContentLoaded", () => initServiceWorker());
    document.addEventListener("DOMContentLoaded", () => {
        let previousPath = null;
        window.addEventListener('message', function (e) {
            if (e.origin === window.location.origin && e.data.type === "path") {
                const currentPath = e.data.message;
                const iframeEl = Array.from(document.body.querySelectorAll(`iframe[src="${currentPath}"]`))[0];
                const indexOf = Array.from(document.body.querySelectorAll("iframe")).indexOf(iframeEl);
                const vw = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--index-grid-cell-width'));
                const vh = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--index-grid-cell-height'));
                const translateValues = [
                    {translateX: `${1 * vw}vw`, translateY: `${0 * vh}vh`},
                    {translateX: `${0 * vw}vw`, translateY: `${0 * vh}vh`},
                    {translateX: `${-1 * vw}vw`, translateY: `${0 * vh}vh`},
                    {translateX: `${0 * vw}vw`, translateY: `${1 * vh}vh`},
                ];
                previousPath = currentPath;
                const {translateX, translateY} = translateValues[indexOf];
                anime({
                    targets: 'main',
                    translateX: translateX,
                    translateY: translateY,
                    duration: 333,
                    easing: 'linear',
                    // complete
                });
            }
        });
    });
</script>
{%endblock%}