<!DOCTYPE html>
<html lang="en">
<head>
    <title>Draw</title>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="keyword">
    <link rel="icon" href="/icon512_rounded.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js?" defer type="text/javascript" crossorigin="anonymous"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js?" defer type="text/javascript" crossorigin="anonymous"></script>
    <script src="../client/script/css_dev_watch.js?" defer type="text/javascript"></script>
    <script src="../client/script/iframe_detect.js?" defer type="text/javascript"></script>
    <script src="../client/script/edit_detect.js?" defer type="text/javascript"></script>
    <script src="../client/script/socket.js?" defer type="text/javascript"></script>
    <script src="../client/script/get_path.js?" defer type="text/javascript"></script>
    <link href="../client/style/variables.css?" rel="stylesheet">
    <link href="../client/style/reset.css?" rel="stylesheet">
    <link href="../client/style/base.css?" rel="stylesheet">
    <link href="../client/style/iframe.css?" rel="stylesheet">
    <meta name="INDEX" content="index.html">
    <meta name="PANEL_DASHBOARD" content="panel-dashboard.html">
    <meta name="PANEL_ACTIONS" content="panel-actions.html">
    <meta name="PANEL_LAYOUT" content="panel-layout.html">
    <meta name="PANEL_DRAW" content="panel-draw.html">
    <meta name="PANEL_EMBED" content="embed.html">
    <meta name="PANEL_FEATURE_EMBED" content="embed-feature.html">
    <meta name="PANEL_MEDIA_EMBED" content="embed-media.html">
    <meta name="PANEL_DRAW_EMBED" content="embed-draw.html">
    <meta name="PANEL_SOUND_EMBED" content="embed-sound.html">
    <meta name="API_STYLE_GET" content="https://api.dbdbdbdbdbgroup.com/demo/api/style/get">
    <meta name="API_CONFIG_GET" content="https://api.dbdbdbdbdbgroup.com/demo/api/config/get">
    <meta name="API_SIGNAL_CREATE" content="https://api.dbdbdbdbdbgroup.com/demo/api/signal/create">
    <meta name="API_CONFIG_UPDATE" content="https://api.dbdbdbdbdbgroup.com/demo/api/config/update">
    <meta name="API_STYLE_UPDATE" content="https://api.dbdbdbdbdbgroup.com/demo/api/style/update">
    <meta name="API_MEDIA_UPDATE" content="https://api.dbdbdbdbdbgroup.com/demo/api/media/update">
    <meta name="TWITCH_LOGIN" content="https://api.dbdbdbdbdbgroup.com/demo/t/w/i/t/c/h/l/o/g/i/n/">
    <meta name="TWITCH_LOGIN_SUCCESS" content="https://api.dbdbdbdbdbgroup.com/t/w/i/t/c/h/l/o/g/i/n/s/u/c/c/e/s/s/">
<style>
    #embed {
        width: 100vw;
        height: 100vh;
        object-fit: contain;
        background: none;
    }
</style>
<style>
    :root {
        --_draw-sel: 1;
        --_draw-o: 100.0;
        --_draw-tX: 50.0;
        --_draw-tY: 50.0;
        --_draw-sX: 50.0;
        --_draw-sY: 50.0;
        --_draw-rX: 50.0;
        --_draw-rY: 50.0;
    }
</style>
<style id="public_module_styles"></style>
<style>
    html.edit #embed {
        box-shadow: inset 0 0 25px 25px #000;
        background-color: #dbdbdb;
        opacity: 0.8;
        background-image: linear-gradient(-45deg, #dbdbdb, #dbdbdb 50%, #ffffff 50%, #ffffff);
        background-size: 23px 23px;
    }
    main {
        perspective: calc(1 * 1920px);
        transform: translateX(calc(calc(var(--_draw-tX) * -1%) + 50%))
        translateY(calc(calc(var(--_draw-tY) * -1%) + 50%));
    }
    #embed {
        box-sizing: border-box;
        object-fit: scale-down;
        opacity: calc(var(--_draw-o)/100);
        transform: scaleX(calc(calc(var(--_draw-sX) * 0.01) + 0.0))
        scaleY(calc(calc(var(--_draw-sY) * 0.01) + 0.0))
        rotateX(calc(calc(var(--_draw-rY) * 1.8deg) - 90deg))
        rotateY(calc(calc(var(--_draw-rX) * -1.8deg) - 90deg))
        rotateZ(0deg)
        scaleX(-1);
    }
</style>
</head>
<body>
<main>
    <canvas id="embed"></canvas>
</main>
<script>
    document.addEventListener("DOMContentLoaded", () => cssDevWatch());
    document.addEventListener("DOMContentLoaded", () => iframeDetect());
    document.addEventListener("DOMContentLoaded", () => editDetect());
    document.addEventListener("DOMContentLoaded", () => socketConnect());
    document.addEventListener("DOMContentLoaded", () => socketWatchReload());
    document.addEventListener("DOMContentLoaded", () => {
        const processStyle = (style) => {
            document.head.querySelector('#public_module_styles').innerHTML = `:root{${style};}`;
            console.log(`processStyle :: set ${style}`);
        };
        const res = axios.get(getPath("API_STYLE_GET"));
        res.then((res) => processStyle(res.data));
        res.catch((error) => console.log("API_STYLE_GET :: error:", error.response.data));
        res.finally(_ => console.info("API_STYLE_GET :: complete"));
    });
    document.addEventListener("DOMContentLoaded", () => socketWatchStyle((payload) => {
        let style = payload.split('style:set:')[1];
        document.head.querySelector('#public_module_styles').innerHTML = `:root{${style};}`;
        console.log(`socketWatchStyle :: draw :: set ${style}`);
    }));
    document.addEventListener("DOMContentLoaded", () => {
        const updateCanvas = () => {
            const canvas = document.querySelector("canvas");
            canvas.width = document.body.getBoundingClientRect().width;
            canvas.height = document.body.getBoundingClientRect().height;
            canvas.style.width = `${canvas.width}px`;
            canvas.style.height = `${canvas.height}px`;
        };
        window.addEventListener('resize', updateCanvas);
        updateCanvas();
    });
    document.addEventListener("DOMContentLoaded", () => socketWatchDrawSet((payload) => {
        if (document.$drawing) {
            console.log('socketWatchDrawSet busy...');
            return;
        }
        document.$drawing = true;
        const pixelSize = 20;
        const playback = payload.split(":")[1].split(",");
        const canvas = document.querySelector("canvas");
        const ctx = document.querySelector("canvas").getContext("2d");
        document.replayDone = () => {
            document.$drawing = setTimeout(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                document.$drawing = false;
            }, 5000);
        };
        document.replayStart = () => {
            if (playback.length) {
                const x = canvas.width * Number(playback.shift());
                const y = canvas.height * Number(playback.shift());
                if (document.$pXY) {
                    const [lastX, lastY] = document.$pXY;
                    if (Math.abs(lastX - x) < 100){
                        const steps = 10;
                        for (let i = 1; i <= steps; i++) {
                            const interpX = lastX + (x - lastX) * (i / steps);
                            const interpY = lastY + (y - lastY) * (i / steps);
                            ctx.beginPath();
                            ctx.arc(interpX, interpY, (pixelSize * 1.25) / 2, 0, Math.PI * 2, false);
                            ctx.fill();
                        }
                    }
                }
                ctx.fillStyle = "#2fffa5";
                ctx.beginPath();
                ctx.arc(x, y, (pixelSize * 1.25) / 2, 0, Math.PI * 2, false);
                ctx.fill();
                document.$pXY = [x, y];
                requestAnimationFrame(document.replayStart);
            } else {
                document.replayDone();
            }
        };
        document.replayStart();
    }));
</script>
</body>
</html>